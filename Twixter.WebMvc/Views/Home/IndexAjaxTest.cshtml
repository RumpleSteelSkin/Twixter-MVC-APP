@model PostViewModel
<h1>Ajax Kullanım</h1><hr/>
<div class="col-md-6 border-start border-end">
    <!-- Yeni Gönderi Paylaşma Alanı -->
    <div class="p-3 border-bottom">
        <form id="newPostForm" method="post">
            <div class="d-flex">
                <img src="/images/nonprofilepictures/blank_profile.webp" class="rounded-circle me-3" width="50" height="50" alt="Profile Picture">
                <div class="flex-grow-1">
                    <textarea id="newPostContent" class="form-control border-0" placeholder="What's going on?" rows="3"></textarea>
                </div>
            </div>
            <div class="d-flex justify-content-between align-items-center mt-2">
                <button type="submit" class="btn btn-primary rounded-pill px-4">Twixle</button>
            </div>
        </form>
    </div>

    <!-- Gönderiler -->
    @foreach (PostResponseDto item in Model.Posts)
    {
        <div class="card border-0 border-bottom p-3">
            <div class="d-flex">
                <img src="@(item.User.ProfilePictureUrl ?? "/images/nonprofilepictures/blank_profile.webp")" 
                     class="rounded-circle me-3" width="50" height="50" alt="Profile Picture">
                
                <div class="flex-grow-1">
                    <div class="d-flex justify-content-between">
                        <div>
                            <strong>@item.User.UserName</strong> 
                            <span class="text-muted">@item.CreatedDate.ToString("MMM dd, yyyy HH:mm")</span>
                        </div>
                    </div>
                    
                    <p class="mt-2 mb-1">@item.Content</p>
                    
                    <div class="d-flex justify-content-between text-muted">
                        <button class="btn btn-sm text-secondary"><i class="bi bi-chat"></i> Comment</button>
                        <button class="btn btn-sm text-secondary"><i class="bi bi-arrow-repeat"></i> Retwix</button>
                        <button class="btn btn-sm text-secondary"><i class="bi bi-heart"></i> Like</button>
                        <button class="btn btn-sm text-secondary"><i class="bi bi-share"></i> Share</button>
                    </div>
                </div>
            </div>
        </div>
    }
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    // Form submit event
    $("#newPostForm").on("submit", function (e) {
        e.preventDefault(); // Formun normal submit işlemini engelle
        
        var content = $("#newPostContent").val(); // Textarea'dan içerik al
        
        // AJAX ile post gönderme
        $.ajax({
            url: '@Url.Action("IndexAjaxTest", "Home")', // Controller ve action URL
            type: 'POST',
            data: { 
                NewPost: { Content: content } // Yeni post verisi
            },
            success: function(response) {
                // Başarılıysa yeni gönderiyi DOM'a ekle
                var newPostHtml = `
                    <div class="card border-0 border-bottom p-3">
                        <div class="d-flex">
                            <img src="${response.userProfilePictureUrl}" class="rounded-circle me-3" width="50" height="50" alt="Profile Picture">
                            <div class="flex-grow-1">
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <strong>${response.userName}</strong> 
                                        <span class="text-muted">${response.createdDate}</span>
                                    </div>
                                </div>
                                <p class="mt-2 mb-1">${response.content}</p>
                                <div class="d-flex justify-content-between text-muted">
                                    <button class="btn btn-sm text-secondary"><i class="bi bi-chat"></i> Comment</button>
                                    <button class="btn btn-sm text-secondary"><i class="bi bi-arrow-repeat"></i> Retwix</button>
                                    <button class="btn btn-sm text-secondary"><i class="bi bi-heart"></i> Like</button>
                                    <button class="btn btn-sm text-secondary"><i class="bi bi-share"></i> Share</button>
                                </div>
                            </div>
                        </div>
                    </div>`;
                // Yeni gönderiyi en üstteki listeye ekle
                $(".col-md-6 .p-3").after(newPostHtml);
                
                // Textarea'yı temizle
                $("#newPostContent").val(""); 
            },
            error: function() {
                alert("Something went wrong!");
            }
        });
    });
</script>
